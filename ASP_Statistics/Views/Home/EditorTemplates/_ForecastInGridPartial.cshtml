@using System.Globalization
@using ASP_Statistics.Enums
@using ASP_Statistics.Utils
@model ForecastViewModel

@{
    string borderClass = HtmlViewHelper.GetCssClassForBorderBy(Model.ThreadNumber);
    string attr = Model.GameResultType == GameResultType.Expectation && Model.GameAt > DateTimeOffset.Now ? "timer" : "";
}

<div class="card bs-2 hover-pointer hover-shadow @borderClass">
    <input type="hidden" asp-for="Id"/>
    
    <div class="card-header d-flex justify-content-between">
        <span class="text-muted text-uppercase"><i class="fas fa-table-tennis pr-2"></i>@Model.Sport.ToString()</span>
        <strong class="text-dark">@Model.GameAt.ToString("G")</strong>
    </div>
    <div @attr class="bg-white h-10em p-2 d-flex align-items-center justify-content-center">
        <img class="card-img-top h-100" src="@Url.Content($"~/images/{Model.GameResultType.ToString()}.svg")" alt="Card image cap">
    </div>
    <div class="card-body">
        <h5 class="d-flex card-text border-bottom justify-content-between">
            <span class="small text-secondary">@Model.CountryName</span>
            <span class="text-primary">@Model.TournamentName</span>
        </h5>
        <h5 class="card-text border-bottom text-center">@Model.GameTeams</h5>
        <h6 class="card-text text-center text-warning">@Model.Bet</h6>
    </div>
    <div class="card-footer">
        <div class="input-group mb-1">
            <div class="input-group-prepend">
                <span class="input-group-text">Coefficient</span>
            </div>
            <input type="number" class="form-control coeff-value" placeholder="Coeff Value" aria-label="Coeff Value" asp-for="Coefficient" step="0.001">
            <div class="input-group-append">
                <span class="input-group-text">0.00</span>
            </div>
        </div>
        <div class="input-group mb-1">
            <div class="input-group-prepend">
                <span class="input-group-text">
                    <i class="fas fa-euro-sign"></i>
                </span>
                <span class="input-group-text">0.00</span>
            </div>
            <input type="number" class="form-control" placeholder="Bet Value" aria-label="Bet Value" asp-for="BetValue" step="0.001">
        </div>
        <div class="hidden-options-container">
            <div class="input-group mb-1">
                <div class="input-group-prepend w-50">
                    <span class="input-group-text bg-danger w-100"></span>
                </div>
                <input type="number" class="form-control" placeholder="Thread Number" aria-label="Thread Number" asp-for="ThreadNumber">
            </div>
            <div class="input-group mb-1">
                <div class="input-group-prepend">
                    <span class="input-group-text">Game Result</span>
                </div>
                <select class="form-control custom-select" asp-items="Html.GetEnumSelectList<GameResultType>()" asp-for="GameResultType"></select>
            </div>
            <div class="input-group mb-1 d-flex">
                <div class="input-group-prepend">
                    <span class="input-group-text">Show At</span>
                </div>
                <div class="input-group-append flex-fill">
                    <input datepicker class="form-control" placeholder="Show At" asp-for="ShowAt" />
                </div>
            </div>
        </div>
        <div class="input-group">
            <div class="col p-0">
                <button class="edit-forecast-button btn btn-warning w-100" type="button">Edit</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(function() {
        $("input[datepicker]").datepicker({
            uiLibrary: 'bootstrap4',
            value: '@Model.ShowAt.ToString("d")'
        });

        $("input[datepicker]").removeProp("datepicker");

        debugger;
        if ($("div[timer]") != undefined) {
            startCountdown($("div[timer]"), new Date(Date.parse('@Model.GameAt.ToString("d")')));
            $("div[timer]").removeProp("timer");
        }
    });
</script>